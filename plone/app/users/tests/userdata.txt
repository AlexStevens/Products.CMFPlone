User Data Account Panel
=======================

Viewing the user data
---------------------

This is about the '@@user_data' view.

    >>> view_name = '@@user_data'

Viewing user data shouldn't be possible for anonymous users:

    >>> self.browser.open("http://nohost/plone/" + view_name)
    >>> 'Please log in' in self.browser.contents
    True

So let's register as a member and log in:

    >>> self.loginAsMember()

Now we should be able to access the user data panel:

    >>> self.browser.open("http://nohost/plone/" + view_name)
    >>> 'Please log in' in self.browser.contents
    False
    >>> self.browser.url.endswith(view_name)
    True

We have these controls in the form:

    >>> self.browser.getControl(name='form.fullname').value
    ''
    >>> self.browser.getControl(name='form.email').value
    ''
    >>> self.browser.getControl(name='form.home_page').value
    ''
    >>> self.browser.getControl(name='form.location').value
    ''

Now we click the cancel button:

    >>> self.browser.getControl(name="form.actions.cancel").click()
    >>> self.browser.url.endswith(view_name)
    True

There should be no changes at all:

    >>> 'Changes canceled.' in self.browser.contents or self.browser.contents
    True


Trying to save without changes
------------------------------

Now can we save this form without changes?

    >>> self.browser.getControl(name="form.actions.save").click()
    >>> 'Please log in' in self.browser.contents
    False
    >>> self.browser.url.endswith(view_name)
    True
    >>> self.browser.getControl(name="form.actions.save").click()
    >>> 'Required input is missing.' in self.browser.contents
    True

As we have a required field "email", which hasn't been pre-filled in this test,
we will get an error message. (In the real world, users would have an e-mail
address filled in.)


Modifying user data
-------------------

If we do set an e-mail address, we should be able to save the form.

    >>> email_address = 'person@example.com'
    >>> self.browser.getControl(name='form.email').value = email_address
    >>> self.browser.getControl(name="form.actions.save").click()
    >>> 'Required input is missing.' in self.browser.contents
    False
    >>> 'No changes made.' in self.browser.contents
    False
    >>> 'Changes saved.' in self.browser.contents
    True

We should be able to check that value for email address now is the same as what
we put in.

    >>> member = self.membership.getMemberById('test_user_1_')
    >>> read_value = member.getProperty('email','') 
    >>> read_value == email_address
    True

