Security controlpanel: 
Enable/disable user folder
==========================

First some initial setup code:

    >>> browser = self.browser
    >>> self.loginAsManager()

There shouldn't be a user folder in a default Plone :

    >>> browser.open('http://nohost/plone/Members/root')
    Traceback (most recent call last):
    ...
    HTTPError: HTTP Error 404: Not Found

Enable the user folder creation:

    >>> browser.open('http://nohost/plone/@@security-controlpanel')
    >>> browser.getControl(name='form.enable_user_folders').value = True
    >>> browser.getControl(name="form.actions.save").click()
    >>> browser.url.endswith('security-controlpanel')
    True

The personal folder isn't created before the user explicitly are logged out
and logged in again:

    >>> browser.open('http://nohost/plone/Members/root')
    Traceback (most recent call last):
    ...
    HTTPError: HTTP Error 404: Not Found

So the 'My Folder' shouldn't be visible:

    >>> 'My Folder' in browser.contents
    False

Lets do a short cut for the root user and create the member area immediately:

    >>> portal.portal_membership.createMemberArea('root')

There should now be a user folder and the 'My Folder' action should be visible
in the personal bar:

    >>> browser.open('http://nohost/plone/Members/root')
    >>> 'My Folder' in browser.contents
    True

Lets ensure 'My Folder' is click able and contains the member url link:

    >>> browser.getLink('My Folder').click()
    >>> browser.url
    'http://nohost/plone/Members/root'



Test with a member with the 'Member' permission
-----------------------------------------------

Create a new member and log in as member:

    >>> browser.getLink('Log out').click()
    >>> 'You are now logged out' in browser.contents
    True
    
    >>> self.createUser()
    >>> self.loginAsManager(user='member', pwd='secret')
 
There should be a user folder now and the 'My Folder' link should be visible
in the personal bar:

    >>> browser.open('http://nohost/plone/Members/member')
    >>> browser.open('http://nohost/plone')
    >>> 'My Folder' in browser.contents
    True

Log out as member:  

    >>> browser.getLink('Log out').click()
    >>> 'You are now logged out' in browser.contents
    True

Log in as manager and disable user folder creation:

    >>> self.loginAsManager()

    >>> browser.open('http://nohost/plone/@@security-controlpanel')
    >>> browser.getControl(name='form.enable_user_folders').value = False
    >>> browser.getControl(name="form.actions.save").click()
    >>> browser.url.endswith('security-controlpanel')
    True

Log out as manager:  

    >>> browser.getLink('Log out').click()
    >>> 'You are now logged out' in browser.contents
    True

Create a new member and login as new member:

    >>> self.createUser(user='newmember', pwd='secret', )
    >>> self.loginAsManager(user='newmember', pwd='secret')

There shouldn't be a new member folder and no 'My Folder' link:

    >>> browser.open('http://nohost/plone/Members/newmember')
    Traceback (most recent call last):
    ...
    HTTPError: HTTP Error 404: Not Found    
    
    >>> browser.open('http://nohost/plone')
    >>> 'My Folder' in browser.contents
    False
