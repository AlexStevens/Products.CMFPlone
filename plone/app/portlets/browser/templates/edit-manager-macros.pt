<div metal:define-macro="portlet-add-form"
    class="section"
    i18n:domain="plone">

    <form method="get" action="#"
          tal:define="base_url string:${view/baseUrl}/+/"
          tal:attributes="action here/absolute_url">

        <input type="hidden" name="referer" tal:attributes="value request/ACTUAL_URL" />

        <label for="dest"
               class="hiddenStructure"
               i18n:translate="label_add_portlet">
            Add portlet
        </label>

        <select name=":action" 
                onchange="location.href=this.options[this.selectedIndex].value"
                tal:attributes="onchange string:location.href='${here/absolute_url}'+this.options[this.selectedIndex].value">

            <option value="/@@manage-portlets"
                     i18n:translate="label_add_portlet_link">
                Add portlet&hellip;
            </option>

            <tal:options repeat="portlet view/addable_portlets">
                <option tal:attributes="value string:${portlet/addview}"
                        tal:content="portlet/title" />
            </tal:options>

        </select>

        <noscript>
            <input class="standalone"
                   type="submit"
                   value="Add portlet"
                   i18n:attributes="value label_add_portlet;"/>
        </noscript>

    </form>
</div>

<div metal:define-macro="current-portlets-list" class="portletAssignments"
    i18n:domain="plone">
     
    <h4 i18n:translate="heading_portlets_assigned_here">
        Portlets assigned here
    </h4>

    <div tal:attributes="class string:kssattr-viewname-${view/__parent__/__name__}">
        <tal:block repeat="portlet view/portlets">
            <div tal:attributes="class string:managedPortlet portlet kssattr-portlethash-${portlet/hash}">
                <div class="portletHeader">
                    <span class="managedPortletActions">
                    <a href="#" class="up"
                       tal:condition="not:repeat/portlet/start"
                       tal:attributes="href string:${portlet/up_url}&referer=${request/ACTUAL_URL}">&uarr;</a>
                    <a href="#" class="down"
                       tal:condition="not:repeat/portlet/end"
                       tal:attributes="href string:${portlet/down_url}&referer=${request/ACTUAL_URL}">&darr;</a>
                    <a href="#" class="delete"
                       tal:attributes="href string:${portlet/delete_url}&referer=${request/ACTUAL_URL}">&times;</a>
                    </span>
                    <a tal:omit-tag="not:portlet/editview"
                       tal:attributes="href string:${portlet/editview}?referer=${request/ACTUAL_URL}"
                       tal:content="portlet/title" />
                </div>
            </div>
        </tal:block>
    </div>
</div>
